# syncenv

Version-controlled environment variable management with cloud storage

[English](#english) | [日本語](./README.ja.md)

---

## Overview

**syncenv** is a CLI tool for managing environment variables across different versions of your application by syncing them with cloud storage (AWS S3, Azure Blob, or Google Cloud Storage).

## Elevator Pitch (30 seconds)

Ever struggled with "it works on v1.5 for me, but the new team member can't run it because they have the wrong environment variables"?

**syncenv** automatically syncs environment variables to/from AWS/Azure/GCP storage based on your Git tags and branches. With built-in encryption support, your entire team can safely share version-controlled environment configurations.

`git checkout v1.5` → `syncenv pull` — that's all it takes to get the right environment variables for that version.

## Features

- **Git Integration**: Automatically detects current tag/branch
- **Multi-Cloud**: Supports AWS S3, Azure Blob Storage, and Google Cloud Storage
- **Multiple Files**: Manage multiple environment files simultaneously (`.env`, `.env.local`, `config/*.json`, etc.)
- **Path Support**: Supports files in subdirectories with automatic directory creation
- **Secure**: Optional AES-256-GCM encryption
- **Simple**: Single binary written in Go, one configuration file

## Installation

```bash
go install github.com/O6lvl4/syncenv/cmd/syncenv@latest
```

Or build from source:

```bash
git clone https://github.com/O6lvl4/syncenv.git
cd syncenv
go build -o syncenv ./cmd/syncenv

# Or use the build script
./build.sh
```

## Usage Examples

```bash
# Initialize
$ syncenv init

# Push environment variables
$ git checkout v1.5
$ syncenv push  # Automatically saves as v1.5

$ syncenv push --tag v1.6  # Explicitly specify tag

# Pull environment variables
$ git checkout v1.5
$ syncenv pull  # Automatically retrieves v1.5

$ syncenv pull --tag v1.6  # Explicitly specify tag

# List all versions
$ syncenv list

# Show differences
$ syncenv diff v1.5 v1.6
```

## Configuration

Run `syncenv init` to create a `.syncenv.yml` configuration file.

Example configuration:

**Single File:**
```yaml
storage:
  type: s3
  bucket: my-syncenv-bucket
  region: us-west-2
  prefix: envs/  # optional

encryption:
  enabled: true
  key: <auto-generated>  # Automatically generated on init

env_file: .env
```

**Multiple Files (with paths):**
```yaml
storage:
  type: gcs
  project_id: my-project
  bucket_name: my-syncenv-bucket

encryption:
  enabled: true

env_files:
  - .env
  - .env.local
  - config/database/settings.json
  - secrets/api.conf
```

## Encryption Key Management

When encryption is enabled, an encryption key is **automatically generated** and stored in the `.syncenv.yml` configuration file.

**Team Sharing**: Simply share the `.syncenv.yml` file with your team members. No separate key file management needed!

**Security Note**:
- The encryption key is stored in the config file for convenience
- This prevents plain-text storage in cloud storage while keeping setup simple
- For enhanced security, store `.syncenv.yml` in a secure location and share it through secure channels
- Consider adding `.syncenv.yml` to `.gitignore` to prevent accidental commits to public repositories

## Cloud Provider Setup

### AWS S3

Configure AWS credentials:

```bash
export AWS_ACCESS_KEY_ID=your_access_key
export AWS_SECRET_ACCESS_KEY=your_secret_key
```

Or use AWS CLI:

```bash
aws configure
```

### Azure Blob Storage

Set connection string:

```bash
export AZURE_STORAGE_CONNECTION_STRING="DefaultEndpointsProtocol=https;AccountName=..."
```

### Google Cloud Storage

Set GCP credentials:

```bash
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json
```

Or authenticate with gcloud:

```bash
gcloud auth application-default login
```

## Commands

| Command | Description |
|---------|-------------|
| `syncenv init` | Create configuration file |
| `syncenv push [--tag TAG]` | Upload environment variables |
| `syncenv pull [--tag TAG] [-f]` | Download environment variables |
| `syncenv list` | List all stored versions |
| `syncenv diff TAG1 TAG2` | Show differences between two versions |

## Use Cases

- **Version-specific environments**: Maintain different configurations for v1.5, v1.6, etc.
- **Team collaboration**: New team members can quickly get the right environment setup
- **Multiple environments**: Different configurations for development, staging, production
- **Debugging**: Easily switch to old versions with their correct environment variables

## Security Considerations

- Always use encryption when storing sensitive data
- The encryption key is stored in `.syncenv.yml` for convenience - share this file securely with your team
- Use `.gitignore` to prevent committing `.syncenv.yml` and `.env` files to public repositories
- Use cloud provider IAM roles and permissions appropriately
- For maximum security, store `.syncenv.yml` in a secure password manager or secret vault

## Building

### Option 1: Build Script

```bash
./build.sh
```

### Option 2: Direct Build

```bash
unset GOROOT && unset GOPATH && go build -o syncenv ./cmd/syncenv
```

### Option 3: Makefile

```bash
make build
```

## Testing

```bash
# Run tests
make test

# Or directly with go
go test ./...

# Run tests with coverage
make test-coverage
```

## Project Structure

```
syncenv/
├── cmd/syncenv/          # Main entry point
├── internal/
│   ├── archive/         # Tar.gz archive handling for multiple files
│   ├── config/          # Configuration management
│   ├── git/             # Git integration
│   ├── crypto/          # AES-256-GCM encryption
│   ├── storage/         # Cloud storage implementations
│   │   ├── s3.go       # AWS S3
│   │   ├── azure.go    # Azure Blob
│   │   ├── gcs.go      # Google Cloud Storage
│   │   └── mock.go     # Mock storage for testing
│   └── cli/            # CLI commands
├── README.md           # This file (English)
├── README.ja.md        # Japanese documentation
├── LICENSE             # MIT License
├── Makefile           # Build tasks
└── build.sh           # Build script
```

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

MIT License - see [LICENSE](./LICENSE) file for details

## Support

For issues, questions, or feature requests, please open an issue on GitHub.

---

**Project Status**: Production Ready ✅

Successfully tested with:
- ✅ Google Cloud Storage
- ✅ Azure Blob Storage
- ⏳ AWS S3 (implementation complete, pending real-world testing)
